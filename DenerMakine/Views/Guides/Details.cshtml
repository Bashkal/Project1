@model DenerMakine.Entities.Guide

@{
    ViewData["Title"] = "Kılavuz Bilgileri";
}

<h1>Kılavuz Bilgileri</h1>
<hr>
<div class="row">

    <div class="col-md-6"></div>
    @if (Model.FileType == ".mp4")
    {
        <div class="text-muted">
            <video style="width:100%" controls id="videoPlayer">
                <source src="@Model.File" type="video/mp4" />
            </video>
            
        </div>
    }
   
</div>




   
    <div class="container row">
    @if (Model.VideoChapters != null && Model.VideoChapters.Any())
    {
        <h5>Chapters</h5>
        <div>
            @foreach (var chapter in Model.VideoChapters.OrderBy(c => c.StartTime))
            {
                <button type="button" class="btn btn-outline-primary btn-sm m-1" onclick="seekTo('@chapter.StartTime')">
                    @chapter.Title
                </button>
            }
        </div>
    }
        <dl class="row">

            <dt class="col-sm-2">
                @Html.DisplayNameFor(model => model.Name)
            </dt>
            <dd class="col-sm-4">
                @Html.DisplayFor(model => model.Name)
            </dd>
            <dt class="col-sm-2">
                @Html.DisplayNameFor(model => model.Description)
            </dt>
            <dd class="col-sm-4">
                @Html.DisplayFor(model => model.Description)
            </dd>
            <dt class="col-sm-2">
                @Html.DisplayNameFor(model => model.Image)
            </dt>
            <dd class="col-sm-4">
                <img src="@Html.DisplayFor(model => model.Image)" style="max-height:100px" alt="">

            </dd>
            <dt class="col-sm-2">
                @Html.DisplayNameFor(model => model.File)
            </dt>
            <dd class="col-sm-4">
                <a target="_blank" href="@Html.DisplayFor(model => model.File)"><i class="fas fa-file btn btn-primary"></i></a>
                <a asp-action="FileDown" asp-route-id="@(Model.Id)"><i class="fas fa-download btn btn-secondary"></i></a>
            </dd>
            <dt class="col-sm-2">
                @Html.DisplayNameFor(model => model.CreatedDate)
            </dt>
            <dd class="col-sm-4">
                @Html.DisplayFor(model => model.CreatedDate)
            </dd>
            <dt class="col-sm-2">
                @Html.DisplayNameFor(model => model.UpdatedDate)
            </dt>
            <dd class="col-sm-4">
                @Html.DisplayFor(model => model.UpdatedDate)
            </dd>
            <dt class="col-sm-2">
                @Html.DisplayNameFor(model => model.Department)
            </dt>
            <dd class="col-sm-4">
                @Html.DisplayFor(model => model.Department.Name)
            </dd>
        </dl>
    
    <div>
        <a class="btn btn-secondary" onClick="history.go(-1)">Listeye Dön</a>
    </div>
    </div>

    



@section Scripts {
    <script>
        const video = document.getElementById('videoPlayer');
        const timeDisplay = document.getElementById('currentTime');

        function seekTo(timeString) {
            const parts = timeString.split(':').map(Number);
            let seconds = 0;
            if (parts.length === 3) {
                seconds = parts[0] * 3600 + parts[1] * 60 + parts[2];
            } else if (parts.length === 2) {
                seconds = parts[0] * 60 + parts[1];
            }
            video.currentTime = seconds;
            video.play();
        }

        if (video) {
            video.addEventListener('timeupdate', function () {
                const totalSeconds = Math.floor(video.currentTime);
                const hours = String(Math.floor(totalSeconds / 3600)).padStart(2, '0');
                const minutes = String(Math.floor((totalSeconds % 3600) / 60)).padStart(2, '0');
                const seconds = String(totalSeconds % 60).padStart(2, '0');
                timeDisplay.textContent = `${hours}:${minutes}:${seconds}`;
            });
        }
    </script>}
